<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>pgx-outbox</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/theme/sky.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        /* Keep existing heading text-transform override */
        h1, h2, h3, h4, h5, h6 {
            text-transform: none !important; /* Remove uppercase styling */
        }

        /* Remove extra lines from <pre> and <code> */
        pre, code {
            margin: 0 !important;
            padding: 0 !important;
            font-size: 0.8em !important; /* Adjust font size as needed */
            line-height: 1; /* Improve readability */
        }

        /* Enable auto-resize for sections */
        .reveal section {
            overflow: auto !important; /* Enable scrolling for overflowing content */
            padding: 0; /* Remove extra padding */
        }

        /* Prevent unnecessary space in syntax highlighting */
        code[class*="language-"] {
            white-space: pre !important; /* Maintain preformatted text */
        }

        ul ul {
            font-size: 80%;
        }

    </style>

</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h2>pgx-outbox</h2>
            <p>FOSDEM lightning talk</p>
            <p>1 Feb 2025</p>
            <p>Nikolay Kuznetsov</p>
            <p><a href="https://github.com/nikolayk812">@nikolayk812</a></p>
        </section>

        <section>
            <h2>About me</h2>
            <p>Senior software engineer</p>
            <p><span style="color: orange;">Zalando</span> Helsinki</p>
            <p>Pre-owned project</p>
            <p>C → Java → Kotlin → Go</p>
        </section>


        <section>
            <h2>Dual write problem</h2>
            <img src="images/dual_write.png" alt="">
        </section>

        <section>
            <h2>Transactional outbox pattern</h2>
            <img src="images/outbox_pattern.png" alt="">
        </section>

        <section>
            <h2>pgx-outbox library</h2>
            <img src="images/pgx_outbox_logo.png" alt="">
        </section>

        <section>
            <h2>implements</h2>
            <ul>
                <li>Message</li>
                <li>Writer (Postgres)</li>
                <li>Reader</li>
                <li>Forwarder</li>
                <li>Publisher (SNS)</li>
            </ul>
        </section>


        <section>
            <h2>Outbox message</h2>
            <pre><code class="language-golang">
 type Message struct {

	 ID int64 // generated by Postgres

	 Broker string `validate:"required"`

	 Topic string `validate:"required"`

	 Metadata map[string]string // optional

	 Payload []byte `validate:"required,json"`

 }
            </code></pre>
        </section>

        <section>
            <h2>Outbox writer</h2>
            <pre><code class="language-golang">
 type Writer interface {

     // Tx is empty interface to support both pgx.Tx and *sql.Tx
     Write(ctx, tx Tx, message Message) (int64, error)

     // pgx transaction only to invoke SendBatch and Prepare methods
     WriteBatch(ctx, tx pgx.Tx, messages []Message) ([]int64, error)

 }</code></pre>
        </section>

        <section>
            <h2>Writer demo</h2>
            <img src="images/outbox_table_example.png" alt="" style="display: block; margin-bottom: 1px;">
            <img src="images/tracing_example.png" alt="" style="display: block;">
        </section>

        <section>
            <h2>WAL Reader support</h2>
            <p>Write ahead log (WAL), aka</p>
            <p>Change data capture (CDC), aka</p>
            <p>Postgres logical replication</p>
            <p>Work in progress (WIP)</p>
            <p>using <i>jackc/pglogrepl</i></p>
        </section>


        <section>
            <h2>Thank you!</h2>
            <img src="images/gh_qr.png">
            <p><a href="https://github.com/nikolayk812/pgx-outbox">github.com/nikolayk812/pgx-outbox</a></p>
        </section>


    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>
    Reveal.initialize({
        width: "89%", // Use a percentage to make slides responsive
        height: "89%",
        controls: true,
        progress: true,
        slideNumber: true,
        history: true,
        center: true,
        transition: 'slide', // none/fade/slide/convex/concave/zoom
    });

    hljs.highlightAll(); // Initialize code highlighting
</script>
</body>
</html>
